"use strict";var stkfApp=stkfApp||angular.module("stkfApp",["ui.state","ui.bootstrap"]).config(["$stateProvider","$routeProvider","$locationProvider",function(a,b,c){b.when("/",{}).otherwise({redirectTo:"/"}),a.state("menu",{templateUrl:"views/menu.html"}).state("upload",{templateUrl:"views/upload.html",controller:"UploadCtrl"}).state("module1",{"abstract":!0,templateUrl:"views/module1.html"}).state("module1.views",{views:{filterView:{templateUrl:"views/filter.html",controller:"FilterCtrl"},graphView:{templateUrl:"views/module1.graphView.html",controller:"CheckCtrl"}}}).state("module2",{"abstract":!0,templateUrl:"views/module2.html"}).state("module2.views",{views:{filterView:{templateUrl:"views/readOnlyFilter.html",controller:"FilterCtrl"},graphView:{templateUrl:"views/module2.graphView.html",controller:"CheckCtrl"}}}).state("uploadoov",{templateUrl:"views/uploadoov.html",controller:"UploadoovCtrl"}).state("oov",{templateUrl:"views/oov.html",controller:"OovCtrl"}).state("uploadsclite",{templateUrl:"views/uploadsclite.html",controller:"UploadscliteCtrl"}).state("sclite",{templateUrl:"views/sclite.html",controller:"ScliteCtrl"}),c.html5Mode(!0)}]);stkfApp.directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}),stkfApp.factory("filterStorage",function(){var a="filters-angularjs";return{get:function(){return JSON.parse(localStorage.getItem(a)||"[]")},put:function(b){localStorage.setItem(a,JSON.stringify(b))},remove:function(){localStorage.removeItem(a)}}}),stkfApp.factory("OovData",function(){var a={};return{get:function(b){return a[b]||{}},put:function(b,c){a[b]=c}}}),stkfApp.controller("MainCtrl",["$rootScope","$scope","$state","$location","filterStorage","OovData",function(a,b,c,d,e,f){b.toModule2=function(){var a=e.get();b.filtersEmpty=a.length<2,c.transitionTo("module2.views"),Raven.captureMessage((new Date).toUTCString()+",VISIT,Comparision Module")};var g=function(a){var b={},c=a.toLowerCase().split(/\s+/g);for(var d in c)c[d].length>=1&&(b[c[d]]?b[c[d]]+=1:b[c[d]]=1);return b},h=function(a){var b=md5(a),c={Key:b};return bucket.headObject(c,function(d){if(d){var e=_.extend(c,{Body:a,ContentType:"txt"});bucket.putObject(e,function(a){a&&Raven.captureMessage((new Date).toUTCString()+",DATA,ERROR,"+b)})}}),b};b.toModule1=function(){c.transitionTo("module1.views"),Raven.captureMessage((new Date).toUTCString()+",VISIT,Selection Module")},b.toUpload=function(){e.remove(),c.transitionTo("upload"),Raven.captureMessage((new Date).toUTCString()+",VISIT,Data Analysis Upload")},b.toMenu=function(){c.transitionTo("menu"),Raven.captureMessage((new Date).toUTCString()+",VISIT,Main Menu")},b.toUploadOov=function(){c.transitionTo("uploadoov"),Raven.captureMessage((new Date).toUTCString()+",VISIT,OOV Upload")},b.toOov=function(){c.transitionTo("oov"),Raven.captureMessage((new Date).toUTCString()+",VISIT,OOV Page")},b.toUploadSclite=function(){c.transitionTo("uploadsclite"),Raven.captureMessage((new Date).toUTCString()+",VISIT,Substitution Upload")},b.toSclite=function(){c.transitionTo("sclite"),Raven.captureMessage((new Date).toUTCString()+",VISIT,Substitution Page")},b.setData=function(a){b.data=a;var c=h(a);Raven.captureMessage((new Date).toUTCString()+",DATA,Upload Data Analysis,"+c)},b.setScliteData=function(a){b.sclitedata=a;var c=h(a);Raven.captureMessage((new Date).toUTCString()+",DATA,Upload Substitution,"+c)},b.setTrainData=function(a){f.put("train",g(a));var b=h(a);Raven.captureMessage((new Date).toUTCString()+",DATA,Upload OOV,Train,"+b)},b.setTestData=function(a){f.put("test",g(a));var b=h(a);Raven.captureMessage((new Date).toUTCString()+",DATA,Upload OOV,Test,"+b)},b.setDictionaryData=function(a){f.put("dictionary",g(a));var b=h(a);Raven.captureMessage((new Date).toUTCString()+",DATA,Upload OOV,Dictionary,"+b)};var i=d.search().module;"dataanalysis"===i?b.toUpload():"oov"===i?b.toUploadOov():"sclite"===i?b.toUploadSclite():c.transitionTo("menu"),a.$on("$stateChangeSuccess",function(a,b,c,d){"module2.views"===b.name&&"module1.views"===d.name&&tour.goTo(10),"module1.views"===b.name&&"module2.views"===d.name&&($("#filter-dropdown").hasClass("open")||$("#filter-dropdown").addClass("open"),window.setTimeout(function(){tour.goTo(9)},1e3))})}]),stkfApp.controller("FilterCtrl",["$scope","$state","$location","filterStorage",function(a,b,c,d){a.filters=d.get(),a.$watch("filters",function(){d.put(a.filters)},!0),a.addFilter=function(){var b={name:a.filterName,array:_.map(graphArray,function(a){return a.filters()})};a.filters.push(b),Raven.captureMessage((new Date).toUTCString()+",SUBSET,Add Subset,"+JSON.stringify({extra:b})),a.filterName=""},a.removeFilter=function(b){var c=a.filters.splice(a.filters.indexOf(b),1);Raven.captureMessage((new Date).toUTCString()+",SUBSET,Remove Subset,"+JSON.stringify({extra:c[0]}))},a.clearFilters=function(){Raven.captureMessage((new Date).toUTCString()+",SUBSET,Clear All Subsets,"+JSON.stringify({extra:a.filters})),a.filters=[]},a.colors=["steelblue","green","black","lime","navy","teal","purple","aqua","red","yellow"]}]),stkfApp.controller("CheckCtrl",["$scope","$state","filterStorage",function(a,b,c){a.$on("$stateChangeSuccess",function(){if(b.is("module1.views"))graphy(a.data);else if(b.is("module2.views")){var d=c.get();Raven.captureMessage((new Date).toUTCString()+",SUBSET,All Subsets,"+JSON.stringify({extra:d})),_.isEmpty(d)||graphy2(a.data,d)}})}]),stkfApp.controller("UploadCtrl",["$scope","$state",function(a){var b=document.getElementById("dropbox");a.dropText="Drop files here...";var c=function(b){b.stopPropagation(),b.preventDefault(),a.$apply(function(){a.dropText="Drop files here...",a.dropClass=""})};b.addEventListener("dragenter",c,!1),b.addEventListener("dragleave",c,!1),b.addEventListener("dragover",function(b){b.stopPropagation(),b.preventDefault();var c=b.dataTransfer&&b.dataTransfer.types&&b.dataTransfer.types.indexOf("Files")>=0;a.$apply(function(){a.dropText=c?"Drop files here...":"Only files are allowed!",a.dropClass=c?"over":"not-available"})},!1),b.addEventListener("drop",function(b){b.stopPropagation(),b.preventDefault(),a.$apply(function(){a.dropText="Drop files here...",a.dropClass=""});var c=b.dataTransfer.files,d=new FileReader;d.onloadend=function(){a.setData(this.result)},d.readAsText(c[0]),c.length>0&&a.$apply(function(){a.files=[];for(var b=0;b<c.length;b++)a.files.push(c[b])})},!1)}]),stkfApp.controller("UploadoovCtrl",["$scope","$state",function(a){var b=document.getElementById("dropbox"),c=0;a.dropText="Drop training, testing, dictionary file(s) here...";var d=function(b){b.stopPropagation(),b.preventDefault(),a.$apply(function(){a.dropText="Drop training, testing, dictionary file(s) here...",a.dropClass=""})};b.addEventListener("dragenter",d,!1),b.addEventListener("dragleave",d,!1),b.addEventListener("dragover",function(b){b.stopPropagation(),b.preventDefault();var c=b.dataTransfer&&b.dataTransfer.types&&b.dataTransfer.types.indexOf("Files")>=0;a.$apply(function(){a.dropText=c?"Drop training, testing, dictionary file(s) here...":"Only files are allowed!",a.dropClass=c?"over":"not-available"})},!1),b.addEventListener("drop",function(b){b.stopPropagation(),b.preventDefault(),a.$apply(function(){a.dropText="Drop training, testing, dictionary file(s) here...",a.dropClass=""});var c=b.dataTransfer.files;c.length>0&&a.$apply(function(){a.files=[];for(var b=0;b<c.length;b++)a.files.push(c[b])})},!1);var e=function(){c>=3&&a.toOov()},f=function(b){var d=b.name,f=new FileReader;/.*train.*/i.test(d)&&(f.onload=function(b){b.target.readyState==FileReader.DONE&&c++,a.setTrainData(this.result),e()}),/.*test.*/i.test(d)&&(f.onload=function(b){b.target.readyState==FileReader.DONE&&c++,a.setTestData(this.result),e()}),/.*(lex|dict).*/i.test(d)&&(f.onload=function(b){b.target.readyState==FileReader.DONE&&c++,a.setDictionaryData(this.result),e()}),f.readAsText(b)};a.processAndToOov=function(){c=0;for(var b=a.files,d=0;d<b.length;d++)f(b[d])}}]),stkfApp.controller("OovCtrl",["$scope","$state","OovData",function(a,b,c){var d=function(a,b){var c={};for(var d in b)_.has(a,d)||(c[d]=b[d]);return c},e=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({key:c,value:a[c]});return b.sort(function(a,b){return b.value-a.value}),b},f=function(a,b){var c=0,d=0;for(var e in b)c+=b[e],_.has(a,e)||(d+=b[e]);return d/c*100};a.trainOovPercent=f(c.get("dictionary"),c.get("train")),a.testOovPercent=f(c.get("dictionary"),c.get("test")),a.trainOov=e(d(c.get("dictionary"),c.get("train"))),a.testOov=e(d(c.get("dictionary"),c.get("test")))}]),stkfApp.controller("UploadscliteCtrl",["$scope","$state",function(a){var b=document.getElementById("dropbox");a.dropText="Drop files here...";var c=function(b){b.stopPropagation(),b.preventDefault(),a.$apply(function(){a.dropText="Drop files here...",a.dropClass=""})};b.addEventListener("dragenter",c,!1),b.addEventListener("dragleave",c,!1),b.addEventListener("dragover",function(b){b.stopPropagation(),b.preventDefault();var c=b.dataTransfer&&b.dataTransfer.types&&b.dataTransfer.types.indexOf("Files")>=0;a.$apply(function(){a.dropText=c?"Drop files here...":"Only files are allowed!",a.dropClass=c?"over":"not-available"})},!1),b.addEventListener("drop",function(b){b.stopPropagation(),b.preventDefault(),a.$apply(function(){a.dropText="Drop files here...",a.dropClass=""});var c=b.dataTransfer.files,d=new FileReader;d.onloadend=function(){a.setScliteData(this.result)},d.readAsText(c[0]),c.length>0&&a.$apply(function(){a.files=[];for(var b=0;b<c.length;b++)a.files.push(c[b])})},!1)}]),stkfApp.controller("ScliteCtrl",["$scope","$state",function(a){for(var b,c=a.sclitedata,d=c.substring(c.lastIndexOf("CONFUSION")+1,c.lastIndexOf("INSERTION")),e=/([0-9]+):( +)([0-9]+)( +)->( +)(.*)( +)==>( +)(.*)/g,f=[],g={};null!==(b=e.exec(d));)f.push([b[3],b[6],b[9]]);for(var h=0;h<f.length;h++){var i=f[h][1];g[i]=g[i]||[],g[i].push({word:f[h][2],times:f[h][0]})}var j=[];for(var k in g)g.hasOwnProperty(k)&&j.push({key:k,value:g[k]});j.sort(function(a,b){var c=0,d=0;return _.reduce(a.value,function(a,b){c+=parseInt(b.times)},0),_.reduce(b.value,function(a,b){d+=parseInt(b.times)},0),d-c}),a.tabData=j,a.times=function(a){var b=0;return _.reduce(a.value,function(a,c){b+=parseInt(c.times)},0),b}}]);